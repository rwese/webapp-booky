# Backend ConfigMap Configuration
# File: backend/k8s/configmap.yaml

apiVersion: v1
kind: ConfigMap
metadata:
  name: booky-config
  namespace: booky-production
  labels:
    app: booky
    component: backend
data:
  # Application Configuration
  NODE_ENV: "production"
  PORT: "3001"
  APP_URL: "https://api.booky.app"
  FRONTEND_URL: "https://booky.app"
  
  # Storage Configuration
  STORAGE_TYPE: "s3"
  STORAGE_PATH: "/app/storage"
  MAX_FILE_SIZE: "10485760"
  
  # CDN Configuration
  CDN_URL: "https://cdn.booky.app"
  CDN_ENABLED: "true"
  
  # Rate Limiting
  RATE_LIMIT_WINDOW_MS: "900000"
  RATE_LIMIT_MAX_REQUESTS: "100"
  RATE_LIMIT_AUTH_MAX_REQUESTS: "10"
  RATE_LIMIT_SEARCH_MAX_REQUESTS: "30"
  
  # Monitoring
  LOG_LEVEL: "info"
  LOG_FORMAT: "json"
  
  # Sync Configuration
  SYNC_MAX_OPERATIONS_PER_BATCH: "100"
  SYNC_MAX_BODY_SIZE: "5242880"
  SYNC_OPERATION_TIMEOUT: "30000"
  
  # File Upload Limits
  MAX_COVER_SIZE: "5242880"
  MAX_AVATAR_SIZE: "2097152"
  ALLOWED_IMAGE_TYPES: "image/jpeg,image/png,image/gif,image/webp"
  
  # CORS
  CORS_ORIGINS: "https://booky.app,https://www.booky.app"
  
  # Feature Flags
  FEATURE_OAUTH_ENABLED: "true"
  FEATURE_PASSWORDLESS_ENABLED: "false"
  FEATURE_2FA_ENABLED: "false"
  FEATURE_IMPORT_EXPORT_ENABLED: "true"
---
# Secrets Configuration (Template - fill in actual values)
apiVersion: v1
kind: Secret
metadata:
  name: booky-secrets
  namespace: booky-production
  labels:
    app: booky
    component: backend
type: Opaque
stringData:
  # IMPORTANT: Replace these values with actual secrets
  # Generate strong random values for production
  
  # Database
  DATABASE_URL: "postgresql://user:password@hostname:5432/booky_production?sslmode=require"
  
  # Authentication
  AUTH_SECRET: "your-super-secret-jwt-key-minimum-32-characters-long"
  AUTH_REFRESH_TOKEN_SECRET: "your-refresh-token-secret"
  AUTH_JWT_EXPIRES_IN: "30d"
  AUTH_REFRESH_TOKEN_EXPIRES_IN: "60d"
  AUTH_BCRYPT_ROUNDS: "12"
  
  # Session
  SESSION_SECRET: "your-session-secret-key"
  
  # AWS (if using S3)
  AWS_ACCESS_KEY_ID: "your-aws-access-key-id"
  AWS_SECRET_ACCESS_KEY: "your-aws-secret-access-key"
  AWS_REGION: "us-east-1"
  AWS_S3_BUCKET: "booky-production"
  
  # CDN
  CDN_API_TOKEN: "your-cdn-api-token"
  
  # Google Books (optional)
  GOOGLE_BOOKS_API_KEY: "your-google-books-api-key"
  
  # Email (optional)
  SMTP_PASSWORD: "your-smtp-password"
  
  # OAuth (optional)
  GOOGLE_CLIENT_SECRET: "your-google-client-secret"
  GITHUB_CLIENT_SECRET: "your-github-client-secret"
  
  # Monitoring
  SENTRY_DSN: "your-sentry-dsn"
---
# Secret Rotation Policy (for advanced secret management)
apiVersion: platform.cnrm.cloud/v1alpha1
kind: SecretRotationPolicy
metadata:
  name: booky-secret-rotation
  namespace: booky-production
spec:
  secretRef: booky-secrets
  rotationPolicy: automatic
  rotationPeriod: P90D
  rotationStrategy: in-place
